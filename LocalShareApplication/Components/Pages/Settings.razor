@page "/settings"
@inherits AppPage
@code {

    int port = SettingsManager.Port;
    int callbackPort = SettingsManager.CallbackPort;
    string samePortWarning = "none";

    private void SetPort(string port)
    {
        try
        {
            samePortWarning = "none";
            SettingsManager.Port = int.Parse(port);
            CheckSamePort();
            this.port = SettingsManager.Port;
        } catch(Exception)
        {
            SettingsManager.Port = SettingsManager.Default.Port;
        }
    }

    private void SetCallbackPort(string callbackPort)
    {
        try
        {
            samePortWarning = "none";
            SettingsManager.CallbackPort = int.Parse(callbackPort);
            CheckSamePort();
            this.callbackPort = SettingsManager.CallbackPort;
        } catch (Exception)
        {
            SettingsManager.CallbackPort = SettingsManager.Default.CallbackPort;
        }
    }

    private void CheckSamePort()
    {
        if(SettingsManager.CallbackPort == SettingsManager.Port)
        {
            samePortWarning = "block";
            throw new Exception();
        }
    }

}

<div id="slide-page" class="page" style="@Loader.PageStyles["Settings"]">

    <div class="header">
        <div class="header-image" @onclick="@Loader.UnloadLatest">
            <img src="images/back-arrow.svg" />
        </div>
        <div class="header-text">
            Settings
        </div>
    </div>

    <div class="options-container">
        <div class="options">
            <div class="option">
                <div class="option-label">
                    Port
                </div>
                <div class="option-input">
                    <input type="number" value="@port" @oninput="(EventArgs) => { SetPort(EventArgs.Value.ToString()); }" />
                </div>
            </div>
            <div class="option">
                <div class="option-label">
                    Callback port
                </div>
                <div class="option-input">
                    <input type="number" value="@callbackPort" @oninput="(EventArgs) => { SetCallbackPort(EventArgs.Value.ToString()); }" />
                </div>
            </div>
            <sup class="option-warning" style="display: @samePortWarning">Ports cannot be the same!</sup>
            <div class="option">
                <div class="option-label option-label-checkbox">
                    Listen for new files
                </div>
                <div class="option-input option-input-checkbox">
                    <input type="checkbox" />
                </div>
            </div>
            <div class="option">
                <div class="option-label option-label-checkbox">
                    Work in background (mobile)
                </div>
                <div class="option-input option-input-checkbox">
                    <input type="checkbox" />
                </div>
            </div>
            <button class="option-button">Clear files log</button>
            <span>Changes will be applied on device restart!</span>
        </div>
    </div>

</div>